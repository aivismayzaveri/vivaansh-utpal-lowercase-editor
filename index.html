<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lowercase Text Editor</title>

  <!-- Quill CSS -->
  <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">

  <style>
    @font-face {
      font-family: "MyStoryFont";
      src:
        url("./fonts/Utpal_lowercase-Regular.ttf") format("truetype"),
        url("./fonts/Utpal_lowercase-Regular.otf") format("opentype");
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    body {
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
      background: #f4f4f4;
    }

    .wrap {
      max-width: 900px;
      margin: 24px auto;
      padding: 0 16px;
    }

    .page {
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 24px rgba(0,0,0,.08);
      overflow: hidden;
    }

    #toolbar.ql-toolbar.ql-snow {
      border: none;
      border-bottom: 1px solid #e5e5e5;
      padding: 12px;
    }

    .ql-container.ql-snow { border: none; }

    .ql-editor {
      font-family: "MyStoryFont", serif !important;
      font-size: 75px;
      line-height: 1.2;
      min-height: 70vh;
      padding: 28px;
    }

    .ql-snow .ql-picker.ql-size .ql-picker-label::before,
    .ql-snow .ql-picker.ql-size .ql-picker-item::before {
      content: attr(data-value);
    }

    .actions {
      display: flex;
      gap: 10px;
      padding: 12px;
      border-top: 1px solid #eee;
      background: #fafafa;
    }

    button {
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background: white;
      cursor: pointer;
    }
    button:hover { background: #f2f2f2; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="page">

      <!-- Toolbar -->
      <div id="toolbar" class="ql-toolbar ql-snow">
        <span class="ql-formats">
          <select class="ql-size">
            <option value="25px">25px</option>
            <option value="35px">35px</option>
            <option value="45px">45px</option>
            <option value="55px">55px</option>
            <option value="65px">65px</option>
            <option value="75px" selected>75px</option>
            <option value="85px">85px</option>
            <option value="95px">95px</option>
            <option value="105px">105px</option>
          </select>
        </span>

        <span class="ql-formats">
          <button class="ql-bold"></button>
          <button class="ql-italic"></button>
          <button class="ql-underline"></button>
          <button class="ql-clean"></button>
        </span>

        <span class="ql-formats">
          <select class="ql-align">
            <option selected></option>
            <option value="center"></option>
            <option value="right"></option>
            <option value="justify"></option>
          </select>
        </span>
      </div>

      <!-- Editor -->
      <div id="editor"></div>

      <!-- Actions -->
      <div class="actions">
        <button id="btnExportPdf">Export</button>
      </div>

    </div>
  </div>

  <!-- Quill JS -->
  <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

  <script>
    const SizeStyle = Quill.import('attributors/style/size');
    SizeStyle.whitelist = ['25px','35px','45px','55px','65px','75px','85px','95px','105px'];
    Quill.register(SizeStyle, true);

    const quill = new Quill('#editor', {
      theme: 'snow',
      modules: { toolbar: '#toolbar' }
    });

    quill.setText("write Something...\n");
    quill.format('size', '75px');

    async function fetchAsDataURL(url) {
      const res = await fetch(url, { cache: "no-store" });
      const blob = await res.blob();
      return new Promise((resolve) => {
        const r = new FileReader();
        r.onload = () => resolve(r.result);
        r.readAsDataURL(blob);
      });
    }

    document.getElementById('btnExportPdf').addEventListener('click', async () => {
      const fontDataUrl = await fetchAsDataURL("./fonts/Utpal_lowercase-Regular.ttf");
      const contentHtml = quill.root.innerHTML;

      const printable = `<!doctype html>
<html>
<head>
<style>
@font-face {
  font-family: "MyStoryFont";
  src: url("${fontDataUrl}");
}
.story {
  font-family: "MyStoryFont";
  font-size: 75px;
  line-height: 0.1;
}
.story .ql-size-25px { font-size: 25px; }
.story .ql-size-35px { font-size: 35px; }
.story .ql-size-45px { font-size: 45px; }
.story .ql-size-55px { font-size: 55px; }
.story .ql-size-65px { font-size: 65px; }
.story .ql-size-75px { font-size: 75px; }
.story .ql-size-85px { font-size: 85px; }
.story .ql-size-95px { font-size: 95px; }
.story .ql-size-105px { font-size: 105px; }
@page { margin: 12mm; }
</style>
</head>
<body>
<div class="story">${contentHtml}</div>
<script>
window.onload = () => setTimeout(() => window.print(), 200);
<\/script>
</body>
</html>`;

      const w = window.open("", "_blank");
      w.document.write(printable);
      w.document.close();
    });
  </script>
</body>
</html>
